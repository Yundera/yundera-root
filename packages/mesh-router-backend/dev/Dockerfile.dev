FROM node:22-alpine

# Install system dependencies
RUN apk add --no-cache \
    git \
    curl \
    bash \
    flock

# Setup pnpm
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable && corepack prepare pnpm@9.9.0 --activate

# Create app directory
WORKDIR /app

# Create directories for logs
RUN mkdir -p /var/log/mesh-router-backend

# Expose port
EXPOSE 8192

# Entrypoint will be mounted at runtime
CMD ["/bin/bash", "/entrypoint-dev.sh"]
